<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escala Policial</title>

<style>
*{box-sizing:border-box}

body{
 margin:0;
 font-family:Arial, sans-serif;
 background:#121212;
 color:#fff;
 padding-top:env(safe-area-inset-top);
}

header{
 background:#0d47a1;
 padding:16px;
 text-align:center;
 font-size:20px;
 font-weight:bold;
 margin-top:10px;
}

.top-controls{
 display:flex;
 gap:8px;
 padding:12px;
 flex-wrap:wrap;
}

select,input,button{
 padding:8px;
 border-radius:6px;
 border:none;
 font-size:14px;
}

button{
 background:#1976d2;
 color:#fff;
}

table{
 width:100%;
 border-collapse:collapse;
}

th,td{
 border:1px solid #333;
 padding:6px;
 text-align:center;
}

th{
 background:#1e1e1e;
}

input.horario{
 width:100%;
 background:#1e1e1e;
 color:#fff;
 border:1px solid #444;
 padding:6px;
}
</style>
</head>

<body>

<header>游늶 Escala Policial</header>

<div class="top-controls">
 <select id="mes"></select>
 <input type="number" id="ano" value="2025">
 <button onclick="gerarDias()">Gerar</button>
 <button onclick="gerarPDF()">PDF</button>
</div>

<table>
<thead>
<tr>
 <th>Dia</th>
 <th>Semana</th>
 <th>Turno / Legenda</th>
 <th>Hor치rio (edit치vel)</th>
 <th>Horas</th>
</tr>
</thead>
<tbody id="dias"></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const meses=[
 "Janeiro","Fevereiro","Mar칞o","Abril","Maio","Junho",
 "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"
];

const mesSelect=document.getElementById("mes");
meses.forEach((m,i)=>{
 let o=document.createElement("option");
 o.value=i; o.text=m;
 mesSelect.add(o);
});

const turnosHoras={
 "1":6,"2":6,"3":6,"4":6,
 "23":12,"34":12,"41":12
};

const horariosPadrao={
 "1":"00h 맙 06h",
 "2":"06h 맙 12h",
 "3":"12h 맙 18h",
 "4":"18h 맙 00h",
 "23":"06h 맙 18h",
 "34":"12h 맙 00h",
 "41":"18h 맙 06h"
};

const legendas=[
 "FER","FOL","APR","TR츽","INS","LUT",
 "NUP","DIM","RSP","TAF","SAU"
];

function gerarDias(){
 const tbody=document.getElementById("dias");
 tbody.innerHTML="";

 const ano=document.getElementById("ano").value;
 const mes=mesSelect.value;
 const totalDias=new Date(ano,parseInt(mes)+1,0).getDate();

 for(let d=1;d<=totalDias;d++){
  const data=new Date(ano,mes,d);
  const semana=["Dom","Seg","Ter","Qua","Qui","Sex","S치b"][data.getDay()];

  let options = `
    <option></option>
    <option>1</option><option>2</option>
    <option>3</option><option>4</option>
    <option>23</option><option>34</option><option>41</option>
  `;

  legendas.forEach(l=>{
    options+=`<option>${l}</option>`;
  });

  const tr=document.createElement("tr");
  tr.innerHTML=`
   <td>${d}</td>
   <td>${semana}</td>
   <td>
     <select onchange="atualizarLinha(this)">
       ${options}
     </select>
   </td>
   <td><input class="horario" placeholder="Editar se necess치rio"></td>
   <td class="horas">0</td>
  `;
  tbody.appendChild(tr);
 }
}

function atualizarLinha(select){
 const linha=select.closest("tr");
 const campoHorario=linha.querySelector(".horario");
 const campoHoras=linha.querySelector(".horas");
 const valor=select.value;

 if(turnosHoras[valor]){
   campoHoras.innerText=turnosHoras[valor];
   campoHorario.value=horariosPadrao[valor];
 } else {
   campoHoras.innerText=0;
   campoHorario.value=valor ? valor : "";
 }
}

function gerarPDF(){
 const {jsPDF}=window.jspdf;
 const pdf=new jsPDF("p","mm","a4");

 pdf.setFontSize(16);
 pdf.text("RELAT칍RIO DE ESCALA POLICIAL",105,15,{align:"center"});

 let y=25;
 pdf.setFontSize(10);

 document.querySelectorAll("#dias tr").forEach(tr=>{
  if(y>280){pdf.addPage();y=20;}
  const c=tr.children;
  pdf.text(
   `Dia ${c[0].innerText} (${c[1].innerText}) | ${c[2].innerText} | ${c[3].children[0].value} | ${c[4].innerText}h`,
   10,y
  );
  y+=6;
 });

 pdf.save("escala_policial.pdf");
}
</script>

</body>
</html>
